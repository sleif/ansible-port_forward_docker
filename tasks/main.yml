---
# roles/port_forward_container/tasks/main.yml

- name: 'Start port_forward_container for {{ virtual_host }}'
  community.general.docker_container:
    name: 'port_forward_for_{{ virtual_host | replace(",", "-") }}'
    image: 'marcnuri/port-forward'
    state: started
    restart_policy: always
    recreate: true
    networks:
      - name: "{{ docker_network_name }}"
    networks_cli_compatible: true
    pull: true
    env:
      REMOTE_HOST: '{{ REMOTE_HOST }}'
      REMOTE_PORT: '{{ REMOTE_PORT }}'
      VIRTUAL_HOST: '{{ virtual_host }}'
      LETSENCRYPT_HOST: '{{ virtual_host }}'
      LETSENCRYPT_EMAIL: '{{ letsencrypt_email }}'
